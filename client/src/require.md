# 문서 수정 시 Conflict 기능 구현

## 문제상황

문서를 수정할 때 아래와 같은 문제가 있습니다.

user a 1버전 수정 -> 1버전을 2버전으로 수정
user b 1버전 수정 -> 1버전을 3버전으로 수정

a가 먼저 수정을 하고 b가 수정을 하게 되면 최신 문서에 a의 변경사항은 사라져버리게 됩니다.

## 해결방법

이럴 때 b에게 충돌을 해결하라는 UI를 띄워서 해결 후 반영한다면 a와 b의 변경사항을 동시에 최신 버전으로 반영 시킬 수 있습니다.

## 요구사항

### 문서의 최신 버전을 확인하는 방법

`document/uuid/log` API는 특정 uuid 문서의 로그들을 확인할 수 있습니다.
아래 형태의 배열이 이 API의 응답입니다.

```json
{
  "id": 1,
  "version": 1,
  "writer": "writer_9509bbbcd197",
  "documentBytes": 1024,
  "generateTime": "2024-03-22T15:01:26.180901"
}
```

여기서 version을 활용할 예정입니다.

문서 수정 페이지에 접속할 때, 문서의 최신 데이터와 버전을 갖고 있습니다.
작성완료 버튼을 누를 때 document/uuid/log API를 호출하여 가장 최신의 버전을 가져온뒤, 위 버전과 일치하지 않다면 문제가 있다고 판단하면 된다고 생각합니다.

### Conflict 요구사항

- `작성완료` 버튼을 누를 때 버전이 일치하지 않으면 에러를 일으킵니다.
- 버전 불일치 에러가 발생하면 충돌했다고 인식하고 모달을 실행합니다.
- 모달 내부는 `편집기`와 `충돌해결완료` 버튼이 있습니다.
- 편집기 내용 요구사항

  - git conflict 처럼 <<<<, >>>> 을 사용해서 최신 버전과, 이전 버전이 충돌하는 곳을 강조해서 보여줍니다.
  - 색도 다르게 보여주면 좋습니다.
  - 이전 버전과 현재 버전을 비교할 때 효율적인 알고리즘을 활용하고 싶습니다.
  - 문자열을 한줄 한줄 비교하는 것과, levenshtein 알고리즘을 사용해서 추적하는 것 중 어느것이 효율적일지 궁금합니다.

- `<<<<`이나 `>>>>` 표시 Git의 충돌 마크가 사라지기 전까지 충돌해결완료 버튼은 disabled 상태로 유지됩니다.
- 충돌 마크가 사라지면 충돌해결완료 버튼이 활성화됩니다.

- 모달의 외부 영역을 클릭하면 모달이 종료되고 작업이 취소됩니다.
- 모달은 CreatePortal로 띄우고 document.body 아래 띄우도록 합니다.

- 충돌해결완료 버튼을 누르면 다시 문서 수정 API가 호출되어 문서 수정이 완료됩니다.

- dd
